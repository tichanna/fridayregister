<!DOCTYPE html>
<html>
<head>
  <title>Friday Slot Booking</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 500px;
      margin: 40px auto;
    }
    label, select, input {
      display: block;
      margin-bottom: 12px;
      width: 100%;
      box-sizing: border-box;
      padding: 8px;
    }
    button {
      padding: 10px;
      background-color: #0077cc;
      color: white;
      border: none;
      cursor: pointer;
      width: 100%;
    }
    #message {
      margin-top: 20px;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <h2>Book a Friday Slot</h2>

  <label for="fullname">Full Name:</label>
  <input type="text" id="fullname" required>

  <label for="email">Email:</label>
  <input type="email" id="email" required>

  <label for="slot">Select a Friday:</label>
  <select id="slot">
    <option value="">Loading slots...</option>
  </select>

  <button onclick="bookSlot()">Book Slot</button>

  <div id="message"></div>

  <script>
    const endpoint = "https://script.google.com/macros/s/AKfycbwaxOvo4Gssztf_Z9I7Ho9K7dCGpXIDuyG6eehR3OtAMlkwHfa0dSG7tkAAyvHiZ1D0sg/exec";

    async function loadSlots() {
      try {
        const res = await fetch(endpoint);
        const slots = await res.json();

        const select = document.getElementById('slot');
        select.innerHTML = "";

        if (slots.length === 0) {
          select.innerHTML = '<option value="">No available slots</option>';
          return;
        }

        const monthNames = ["Jan", "Feb", "Mar", "Apr", "May", "Jun",
                            "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];

        for (const slot of slots) {
          const [day, month, year] = slot.date.split('-');
          const displayText = `${day} ${monthNames[parseInt(month) - 1]}`;
          const option = document.createElement('option');
          option.value = slot.date;
          option.textContent = displayText;
          select.appendChild(option);
        }
      } catch (err) {
        document.getElementById('message').textContent = "❌ Could not load slots.";
      }
    }

    async function bookSlot() {
      const fullname = document.getElementById('fullname').value.trim();
      const email = document.getElementById('email').value.trim();
      const date = document.getElementById('slot').value;

      if (!fullname || !email || !date) {
        document.getElementById('message').textContent = "Please fill in your full name, email, and select a date.";
        return;
      }

      try {
        const res = await fetch(endpoint, {
          method: "POST",
          headers: { "Content-Type": "application/x-www-form-urlencoded" },
          body: new URLSearchParams({ fullname, email, date })
        });

        const result = await res.json();

        if (result.success) {
          document.getElementById('message').textContent = "✅ Slot booked successfully!";
          await loadSlots(); // Refresh
          document.getElementById('fullname').value = '';
          document.getElementById('email').value = '';
        } else {
          document.getElementById('message').textContent = "❌ " + result.message;
        }
      } catch (err) {
        document.getElementById('message').textContent = "❌ Booking failed.";
      }
    }

    window.onload = loadSlots;
  </script>
</body>
</html>
